{% extends 'base.html' %}
{% load static %}

{% block title %}Product {{ object.name }} | OnlineShop{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h1>{{ object.name }}</h1>
    <div class="d-inline-block p-2">
        <img src="{% if object.image %}{{ object.image.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}" class="img-fluid mb-5" alt="product_image" width="300" height="230">
         <a class="btn btn-info" role="button"
            href="{% if not is_in_favorite %}
                        {% url 'goods:add_or_remove_product_favorite' action='add' product_pk=object.id %}
                    {% elif is_in_favorite %}
                        {% url 'goods:add_or_remove_product_favorite' action='remove' product_pk=object.id %}
                    {% else %}
                        {% url 'login' %}
                    {% endif %}">   {% if is_in_favorite %}
                                        Remove from Favorite
                                    {% else %}
                                        Add to Favorite
                                    {% endif %}
        </a>
    </div>

    <div class="d-inline-block">
        <form action="{% url 'cart:cart_add' object.id %}" method="post">
            {% csrf_token %}
            {{ quantity_form.as_p }}
            {{ quantity_form.errors }}
            <button type="submit" class="btn btn-info">Add to cart</button>
        </form>
    </div>
    
    <h4>Current rating: {{ object.rating }}</h4>
    <form action="{% url 'goods:product_detail' object.pk object.slug %}" method="post">
        {% csrf_token %}
        {{ rating_form.star }}
        {{ rating_form.star.errors }}
        <input type="submit" name="rating_sent" class="btn btn-success mt-2" value="Submit">
    </form>
    <h4 align="center">Product characteristics:</h4>
    <ul class="list-group list-group-flush">
        {% for prop, value in object.properties %}
        <div class="row justify-content-between">
            <div class="col-4">
                <li class="list-group-item list-group-item-dark">{{ prop }}</li>
            </div>
            <div class="col-4">
                <li class="list-group-item list-group-item-success">{{ value }}</li>
            </div>
        </div>
        {% endfor %}
    </ul>
    <!--комментарии-->
    <div class="row d-flex justify-content-left">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-0 border" style="background-color: #f0f2f5;">
                <div class="card-body p-4">
                    {% with object.comments.all.count as total_comments %}
                        <h4>Total {{ total_comments }} comment{{ total_comments|pluralize }}</h4>
                    {% endwith %}
                    {% for comment in object.comments.all %}
                        <div class="card mb-4">
                            <div class="card-body">
                                <p>Comment #{{ forloop.counter }} by {{ comment.user_name }}</p>
                                <p>{{ comment.body }}</p>
                                <div class="d-flex justify-content-between">
                                    <div class="d-flex flex-row align-items-center">
                                        {% if comment.profile.photo %}
                                            <img src="{{ comment.profile.photo.url }}" alt="avatar" width="25" height="25" />
                                        {% endif %}
                                        <p class="small mb-0 ms-2">{{ comment.user_name }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <h4>Please, type the comment about product...</h4>
    <form action="{% url 'goods:product_detail' object.pk object.slug %}" method="post">
        {% csrf_token %}
        {% for field in comment_form %}
            {{ field.errors }}
            {{ field.label_tag }}{{ field }}
        {% endfor %}
        <input type="submit" name="comment_sent" class="btn btn-success mt-2" value="Send">
    </form>
</div>
</div>
{% endblock %}

